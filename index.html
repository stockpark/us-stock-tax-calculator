<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ì‹¤ì‹œê°„ ë¯¸êµ­ì£¼ì‹ ì–‘ë„ì†Œë“ì„¸ ê³„ì‚°ê¸°</title>
  <style>
    body { font-family: 'Noto Sans KR', sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    h1 { color: darkred; }
    label, select, input { display: block; margin: 10px 0; width: 100%; padding: 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    .result { font-weight: bold; margin-top: 20px; font-size: 1.2em; color: darkblue; }
    footer { margin-top: 40px; text-align: center; font-size: 0.9em; color: gray; }
  </style>
</head>
<body>
  <h3>ğŸ“¸ ë³´ìœ í˜„í™© ì´ë¯¸ì§€ ì—…ë¡œë“œ</h3>
<input type="file" id="imageUpload" accept="image/*" />
<p id="ocrStatus">OCR ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
<pre id="ocrResult"></pre>

  <h1>ğŸ‡ºğŸ‡¸ ë¯¸êµ­ì£¼ì‹ ì–‘ë„ì†Œë“ì„¸ ê³„ì‚°ê¸°</h1>

  <label>ì¢…ëª©ëª…: <input type="text" id="ticker" placeholder="ì˜ˆ: AAPL"></label>
  <label>ë³´ìœ  ìˆ˜ëŸ‰: <input type="number" id="quantity" placeholder="ì˜ˆ: 100"></label>
  <label>ë§¤ì… ë‹¨ê°€(USD): <input type="number" id="buyPrice" placeholder="ì˜ˆ: 120.5"></label>
  <label>í˜„ì¬ê°€(USD): <input type="number" id="currentPrice" placeholder="ì˜ˆ: 140.3"></label>
  <label>í™˜ìœ¨ (1ë‹¬ëŸ¬ë‹¹ ì›í™”): <input type="number" id="krwRate" placeholder="ì˜ˆ: 1370" value="1370"></label>
  <button onclick="calculate()">ê³„ì‚°í•˜ê¸°</button>

  <div class="result" id="result"></div>

  <footer>Â© 2025 ë¯¸êµ­ì£¼ì‹ ì–‘ë„ì†Œë“ì„¸ ê³„ì‚°ê¸° (Beta)</footer>

  <script>
    function calculate() {
      const qty = parseFloat(document.getElementById('quantity').value);
      const buy = parseFloat(document.getElementById('buyPrice').value);
      const current = parseFloat(document.getElementById('currentPrice').value);
      const rate = parseFloat(document.getElementById('krwRate').value);

      if (isNaN(qty) || isNaN(buy) || isNaN(current) || isNaN(rate)) {
        document.getElementById('result').innerText = "ì…ë ¥ê°’ì„ ëª¨ë‘ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.";
        return;
      }

      const gainUSD = (current - buy) * qty;
      const gainKRW = gainUSD * rate;
      const taxableKRW = Math.max(0, gainKRW - 2500000); // ê¸°ë³¸ ê³µì œ 250ë§Œ ì›
      const tax = taxableKRW * 0.22;

      let result = `ì´ ì–‘ë„ì°¨ìµ: ${gainKRW.toLocaleString()}ì›`;

      if (gainKRW <= 2500000) {
        result += `\nâ¡ï¸ ì–‘ë„ì†Œë“ì„¸ ì—†ìŒ (ê³µì œ ë²”ìœ„)`;
      } else {
        result += `\nê³¼ì„¸í‘œì¤€: ${taxableKRW.toLocaleString()}ì›`;
        result += `\nì˜ˆìƒ ì–‘ë„ì†Œë“ì„¸ (22%): ${Math.round(tax).toLocaleString()}ì›`;
      }

      document.getElementById('result').innerText = result;
    }
  </script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>
<script>
  document.getElementById('imageUpload').addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    document.getElementById("ocrStatus").innerText = "ğŸ” ì´ë¯¸ì§€ ì¸ì‹ ì¤‘ì…ë‹ˆë‹¤...";

    const { createWorker } = Tesseract;
    const worker = createWorker({ logger: m => console.log(m) });

    await worker.load();
    await worker.loadLanguage("eng+kor");
    await worker.initialize("eng+kor");

    const { data: { text } } = await worker.recognize(file);
    await worker.terminate();

    document.getElementById("ocrStatus").innerText = "âœ… ì¸ì‹ ì™„ë£Œ!";
    document.getElementById("ocrResult").innerText = text;

    // ğŸ” ì¢…ëª©ëª… ëª©ë¡ ë§Œë“¤ê¸° (ì˜ë¬¸ ëŒ€ë¬¸ì 3~5ì)
    const tickerMatches = [...text.matchAll(/\b[A-Z]{2,5}\b/g)].map(m => m[0]);
    const tickerCandidates = tickerMatches.filter(ticker => ['AAPL','TSLA','QQQ','SPY','NVDA','MSFT','PLTR','AMZN','GOOGL','META','URNM','URA','SQQQ','TQQQ','SOXL','AMD','INTC'].includes(ticker));

    // ìë™ ì…ë ¥
    if (tickerCandidates.length > 0) {
      const ticker = tickerCandidates[0];
      document.querySelector('input[placeholder*="AAPL"]').value = ticker;
    }
  });
</script>

</body>
</html>
